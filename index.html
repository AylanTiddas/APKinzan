<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Inzan n Teqbaylit : Une collection interactive de proverbes kabyles avec traduction, explications et intelligence artificielle.">
    <meta name="theme-color" content="#F9F7F3">

    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="Inzan n Teqbaylit - Sagesse Kabyle">
    <meta property="og:description" content="D√©couvrez la richesse des proverbes kabyles assist√©e par IA.">
    <meta property="og:type" content="website">
    
    <title>Inzan n Teqbaylit | Sagesse Kabyle</title>

    <!-- Tailwind CSS (Via CDN pour la portabilit√© fichier unique) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configuration Tailwind personnalis√©e -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        kabyle: {
                            base: '#F9F7F3',     // Blanc cass√© (Laine)
                            dark: '#1A1C20',     // Noir charbon
                            primary: '#3A5F40',  // Vert Olivier Profond
                            secondary: '#C07A50',// Terre Cuite / Poterie
                            accent: '#EDC048',   // Or (Bijoux)
                            surface: '#FFFFFF',
                            'surface-dark': '#242830'
                        }
                    },
                    fontFamily: {
                        serif: ['Tinos', 'serif'],
                        sans: ['Raleway', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- Polices -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tinos:ital,wght@0,400;0,700;1,400&family=Raleway:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Ic√¥nes (Favicon g√©n√©r√© dynamiquement via SVG) -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90' fill='%233A5F40'%3E‚µ£%3C/text%3E%3C/svg%3E">

    <style>
        /* Styles globaux et utilitaires CSS personnalis√©s */
        :root {
            --card-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.08);
            --card-shadow-hover: 0 20px 40px -10px rgba(0, 0, 0, 0.12);
        }

        body {
            background-color: #F9F7F3;
            background-image: radial-gradient(#3A5F40 0.5px, transparent 0.5px);
            background-size: 24px 24px;
            /* Tonalit√© de fond subtile */
            background-attachment: fixed;
        }

        .dark body {
            background-color: #111316;
            background-image: radial-gradient(#3A5F40 0.5px, transparent 0.5px);
        }

        /* Scrollbar personnalis√©e */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 3px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        ::-webkit-scrollbar-thumb:hover { background: #94A3B8; }

        /* Loader CSS */
        .spinner {
            width: 24px; height: 24px;
            border: 3px solid currentColor;
            border-bottom-color: transparent;
            border-radius: 50%;
            animation: rotation 1s linear infinite;
            display: inline-block;
        }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Animations sp√©cifiques */
        .card-hover { transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .card-hover:hover { transform: translateY(-4px); box-shadow: var(--card-shadow-hover); }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .dark .glass-panel {
            background: rgba(36, 40, 48, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Highlight de recherche */
        mark { background-color: #EDC048; color: #1A1C20; padding: 0 2px; border-radius: 2px; }

        /* Transitions de pages */
        .tab-content {
            display: none;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.4s ease-out, transform 0.4s ease-out;
        }
        .tab-content.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Styles sp√©cifiques Toast */
        #toast { transform: translateY(150%); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        #toast.show { transform: translateY(0); }
    </style>
</head>
<body class="text-kabyle-dark dark:text-gray-200 antialiased min-h-screen flex flex-col transition-colors duration-300">

    <!-- Splash Screen -->
    <div id="splash-screen" class="fixed inset-0 z-[200] bg-kabyle-base dark:bg-kabyle-dark flex flex-col items-center justify-center transition-opacity duration-700">
        <div class="relative w-24 h-24 mb-4 animate-float">
            <svg viewBox="0 0 100 100" class="w-full h-full text-kabyle-primary fill-current drop-shadow-xl">
                <text x="50" y="80" font-size="80" text-anchor="middle" font-family="sans-serif" font-weight="bold">‚µ£</text>
            </svg>
        </div>
        <h1 class="text-3xl font-serif font-bold text-kabyle-primary tracking-wider">INZAN</h1>
        <p class="text-sm font-sans text-gray-500 mt-2 tracking-widest uppercase">Sagesse Kabyle</p>
    </div>

    <!-- Header -->
    <header class="sticky top-0 z-40 w-full glass-panel shadow-sm transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <!-- Logo -->
            <div class="flex items-center gap-2 cursor-pointer select-none" onclick="app.nav.switchTab('accueil-tab')">
                <span class="text-3xl text-kabyle-secondary font-bold" aria-hidden="true">‚µ£</span>
                <div class="leading-none">
                    <h1 class="font-serif font-bold text-xl text-kabyle-primary dark:text-kabyle-accent">Inzan</h1>
                </div>
            </div>

            <!-- Desktop Nav -->
            <nav class="hidden md:flex items-center gap-1 bg-gray-100/50 dark:bg-gray-800/50 p-1 rounded-full border border-gray-200 dark:border-gray-700">
                <button data-target="accueil-tab" class="nav-item px-4 py-1.5 rounded-full text-sm font-medium transition-all hover:text-kabyle-primary" onclick="app.nav.switchTab('accueil-tab')">Accueil</button>
                <button data-target="explorer-tab" class="nav-item px-4 py-1.5 rounded-full text-sm font-medium transition-all hover:text-kabyle-primary" onclick="app.nav.switchTab('explorer-tab')">Explorer</button>
                <button data-target="favoris-tab" class="nav-item px-4 py-1.5 rounded-full text-sm font-medium transition-all hover:text-kabyle-primary" onclick="app.nav.switchTab('favoris-tab')">Favoris</button>
                <button data-target="ai-tab" class="nav-item px-4 py-1.5 rounded-full text-sm font-medium transition-all hover:text-kabyle-primary flex items-center gap-1" onclick="app.nav.switchTab('ai-tab')">
                    <span>Sage AI</span>
                    <span class="bg-kabyle-accent text-[10px] text-black px-1 rounded font-bold">NEW</span>
                </button>
                <button data-target="quiz-tab" class="nav-item px-4 py-1.5 rounded-full text-sm font-medium transition-all hover:text-kabyle-primary" onclick="app.nav.switchTab('quiz-tab')">Quiz</button>
            </nav>

            <!-- Actions Droite -->
            <div class="flex items-center gap-3">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors text-kabyle-primary dark:text-kabyle-accent" aria-label="Changer de th√®me">
                    <svg class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                    <svg class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-6 pb-24 md:pb-8">
        
        <!-- TAB: ACCUEIL -->
        <section id="accueil-tab" class="tab-content active max-w-4xl mx-auto">
            <div class="text-center mb-10 animate-fade-in-up">
                <span class="inline-block py-1 px-3 rounded-full bg-kabyle-primary/10 text-kabyle-primary text-xs font-bold uppercase tracking-wide mb-3 border border-kabyle-primary/20">H√©ritage Culturel</span>
                <h2 class="text-4xl md:text-5xl font-serif font-bold text-kabyle-primary dark:text-white mb-4">Tr√©sors de la Sagesse Kabyle</h2>
                <p class="text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
                    Une collection num√©rique interactive pour pr√©server et explorer les <span class="font-serif italic text-kabyle-secondary">Inzan</span> (proverbes).
                </p>
            </div>

            <!-- Carte Proverbe du Jour -->
            <div class="relative group mb-12 animate-fade-in-up" style="animation-delay: 100ms;">
                <div class="absolute -inset-1 bg-gradient-to-r from-kabyle-primary to-kabyle-secondary rounded-2xl blur opacity-25 group-hover:opacity-50 transition duration-500"></div>
                <div class="relative bg-kabyle-surface dark:bg-kabyle-surface-dark rounded-xl p-8 shadow-xl border border-gray-100 dark:border-gray-700">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-sm font-bold text-kabyle-secondary uppercase tracking-wider flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                            Proverbe du Jour
                        </h3>
                        <span id="daily-date" class="text-xs text-gray-400 font-mono"></span>
                    </div>
                    <div id="daily-proverb-container" class="text-center py-4">
                        <div class="spinner text-kabyle-primary"></div>
                    </div>
                </div>
            </div>

            <!-- Raccourcis Rapides -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 animate-fade-in-up" style="animation-delay: 200ms;">
                <div onclick="app.nav.switchTab('explorer-tab')" class="cursor-pointer bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md hover:border-kabyle-primary transition-all group">
                    <div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </div>
                    <h4 class="font-bold text-lg mb-1">Rechercher</h4>
                    <p class="text-sm text-gray-500">Trouvez un proverbe par mot-cl√© ou th√©matique.</p>
                </div>
                <div onclick="app.nav.switchTab('ai-tab')" class="cursor-pointer bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md hover:border-kabyle-secondary transition-all group">
                    <div class="w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    </div>
                    <h4 class="font-bold text-lg mb-1">Le Sage AI</h4>
                    <p class="text-sm text-gray-500">D√©crivez une situation, le sage vous r√©pondra.</p>
                </div>
                <div onclick="app.nav.switchTab('quiz-tab')" class="cursor-pointer bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md hover:border-kabyle-accent transition-all group">
                    <div class="w-10 h-10 rounded-full bg-yellow-100 text-yellow-600 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                    </div>
                    <h4 class="font-bold text-lg mb-1">Quiz</h4>
                    <p class="text-sm text-gray-500">Testez vos connaissances et apprenez.</p>
                </div>
            </div>
            
            <!-- Cr√©dit Auteur -->
            <div class="mt-12 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg border-l-4 border-kabyle-secondary text-sm text-gray-600 dark:text-gray-400">
                <p>Contenu inspir√© en partie des ≈ìuvres de <strong class="text-kabyle-dark dark:text-white">M. Aomar SIDER</strong> ("INZAN amek i d-llan").</p>
            </div>
        </section>

        <!-- TAB: EXPLORER -->
        <section id="explorer-tab" class="tab-content">
            <div class="sticky top-20 z-30 bg-kabyle-base/95 dark:bg-kabyle-dark/95 backdrop-blur-md py-4 mb-6 -mx-4 px-4 sm:mx-0 sm:px-0 border-b border-gray-200 dark:border-gray-800">
                <div class="flex flex-col md:flex-row gap-4">
                    <!-- Barre de recherche -->
                    <div class="relative flex-grow">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        </div>
                        <input type="text" id="search-input" class="block w-full pl-10 pr-10 py-3 border-transparent bg-white dark:bg-gray-800 shadow-sm rounded-xl focus:ring-2 focus:ring-kabyle-primary focus:bg-white dark:focus:bg-gray-700 transition-colors" placeholder="Rechercher un mot (ex: 'thamourth', 'amiti√©')...">
                        <button id="clear-search" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 hidden">
                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </div>
                    <!-- Bouton Al√©atoire -->
                    <button onclick="app.explorer.random()" class="flex items-center justify-center gap-2 px-6 py-3 bg-kabyle-secondary text-white rounded-xl font-semibold shadow-sm hover:bg-kabyle-primary transition-colors active:scale-95">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                        <span>Al√©atoire</span>
                    </button>
                </div>
                
                <!-- Filtres par Th√®mes -->
                <div class="mt-4 overflow-x-auto pb-2 custom-scrollbar">
                    <div id="theme-filters" class="flex gap-2 min-w-max">
                        <!-- Inject√© par JS -->
                    </div>
                </div>
            </div>

            <!-- Liste R√©sultats -->
            <div id="results-stats" class="text-sm text-gray-500 mb-4 h-5"></div>
            <div id="results-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Cartes inject√©es par JS -->
                <div class="col-span-full py-12 text-center">
                    <div class="spinner text-gray-400"></div>
                    <p class="mt-2 text-gray-500">Chargement de la biblioth√®que...</p>
                </div>
            </div>
            <div id="load-more-trigger" class="h-20 w-full flex items-center justify-center mt-8 opacity-0">
                <div class="spinner text-kabyle-primary"></div>
            </div>
        </section>

        <!-- TAB: FAVORIS -->
        <section id="favoris-tab" class="tab-content">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-serif font-bold text-kabyle-primary dark:text-white">Vos Favoris</h2>
                <p class="text-gray-500 mt-2">Retrouvez ici les proverbes que vous avez sauvegard√©s.</p>
            </div>
            <div id="favorites-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 min-h-[300px]">
                <!-- Inject√© par JS -->
            </div>
            <div id="no-favorites" class="hidden flex flex-col items-center justify-center py-12 opacity-70">
                <svg class="w-16 h-16 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
                <p class="text-lg text-gray-500">Aucun favori pour le moment.</p>
                <button onclick="app.nav.switchTab('explorer-tab')" class="mt-4 text-kabyle-primary hover:underline">Aller explorer</button>
            </div>
        </section>

        <!-- TAB: AI SAGE -->
        <section id="ai-tab" class="tab-content max-w-3xl mx-auto">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden border border-gray-100 dark:border-gray-700">
                <!-- Header AI -->
                <div class="bg-kabyle-primary p-6 text-white">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-2xl backdrop-blur-sm">
                            ü§ñ
                        </div>
                        <div>
                            <h2 class="text-xl font-bold font-serif">Le Sage Artificiel</h2>
                            <p class="text-kabyle-base/80 text-sm">D√©crivez une situation, je trouverai le proverbe adapt√©.</p>
                        </div>
                    </div>
                </div>

                <!-- Zone Conversation -->
                <div class="p-6">
                    <div class="mb-6 relative">
                        <textarea id="ai-input" rows="3" class="w-full p-4 rounded-xl bg-gray-50 dark:bg-gray-900 border-2 border-gray-200 dark:border-gray-700 focus:border-kabyle-primary focus:ring-0 resize-none transition-colors" placeholder="Exemple: Mon ami parle beaucoup mais n'agit jamais..."></textarea>
                        <button id="ai-submit-btn" class="absolute bottom-3 right-3 bg-kabyle-primary text-white p-2 rounded-lg hover:bg-kabyle-secondary transition-colors disabled:opacity-50 disabled:cursor-not-allowed" aria-label="Envoyer">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                        </button>
                    </div>

                    <div id="ai-response-area" class="space-y-4 min-h-[100px]">
                        <div class="text-center text-gray-400 text-sm italic">
                            Le sage attend votre question...
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- TAB: QUIZ -->
        <section id="quiz-tab" class="tab-content max-w-2xl mx-auto">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-100 dark:border-gray-700 overflow-hidden">
                <div id="quiz-start" class="p-8 text-center">
                    <div class="w-20 h-20 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center text-3xl mx-auto mb-6">
                        üß†
                    </div>
                    <h2 class="text-2xl font-bold font-serif mb-2 text-kabyle-dark dark:text-white">Quiz de Sagesse</h2>
                    <p class="text-gray-500 mb-8">L'IA va g√©n√©rer 5 questions bas√©es sur notre base de proverbes.</p>
                    <button id="start-quiz-btn" class="w-full py-3 px-6 bg-kabyle-primary text-white rounded-xl font-bold hover:bg-kabyle-secondary transition-all transform hover:scale-[1.02]">
                        Commencer le D√©fi
                    </button>
                </div>

                <div id="quiz-game" class="hidden p-6">
                    <div class="flex justify-between items-center mb-6 text-sm font-medium text-gray-400">
                        <span id="quiz-progress">Question 1/5</span>
                        <span id="quiz-score" class="text-kabyle-primary">Score: 0</span>
                    </div>
                    
                    <div id="quiz-question-container" class="mb-8">
                        <!-- Question inject√©e -->
                    </div>

                    <div id="quiz-options" class="space-y-3">
                        <!-- Options inject√©es -->
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="hidden md:block bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 py-8 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-gray-500 text-sm">
                &copy; <span id="year"></span> Inzan n Teqbaylit. D√©velopp√© avec passion pour la culture.
            </p>
        </div>
    </footer>

    <!-- Mobile Bottom Nav -->
    <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-white/90 dark:bg-gray-900/90 backdrop-blur-lg border-t border-gray-200 dark:border-gray-800 flex justify-around items-center px-2 py-3 z-50 pb-safe">
        <button class="mobile-nav-item active flex flex-col items-center gap-1 w-full text-gray-400" onclick="app.nav.switchTab('accueil-tab')" data-target="accueil-tab">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
            <span class="text-[10px] font-medium">Accueil</span>
        </button>
        <button class="mobile-nav-item flex flex-col items-center gap-1 w-full text-gray-400" onclick="app.nav.switchTab('explorer-tab')" data-target="explorer-tab">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            <span class="text-[10px] font-medium">Explorer</span>
        </button>
        <div class="relative -top-6">
            <button onclick="app.nav.switchTab('ai-tab')" class="w-14 h-14 bg-kabyle-secondary text-white rounded-full shadow-lg flex items-center justify-center transform transition-transform active:scale-90 border-4 border-kabyle-base dark:border-kabyle-dark">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
            </button>
        </div>
        <button class="mobile-nav-item flex flex-col items-center gap-1 w-full text-gray-400" onclick="app.nav.switchTab('favoris-tab')" data-target="favoris-tab">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
            <span class="text-[10px] font-medium">Favoris</span>
        </button>
        <button class="mobile-nav-item flex flex-col items-center gap-1 w-full text-gray-400" onclick="app.nav.switchTab('quiz-tab')" data-target="quiz-tab">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
            <span class="text-[10px] font-medium">Quiz</span>
        </button>
    </nav>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-24 md:bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 z-[100]">
        <span id="toast-icon">‚úÖ</span>
        <p id="toast-msg" class="text-sm font-medium">Action effectu√©e</p>
    </div>

    <!-- Modal D√©tails -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/60 z-[150] hidden opacity-0 transition-opacity duration-300 backdrop-blur-sm" onclick="app.ui.closeModal()"></div>
    <div id="modal-content" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-lg bg-white dark:bg-gray-800 rounded-2xl shadow-2xl z-[151] hidden opacity-0 scale-95 transition-all duration-300 flex flex-col max-h-[80vh]">
        <div class="p-6 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center">
            <h3 id="modal-title" class="text-xl font-serif font-bold text-kabyle-primary">D√©tails</h3>
            <button onclick="app.ui.closeModal()" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full">
                <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        <div id="modal-body" class="p-6 overflow-y-auto prose dark:prose-invert"></div>
    </div>

    <script>
        /**
         * Architecture de l'Application "Inzan"
         * Organis√©e en modules pour la maintenabilit√© et la performance.
         */
        
        const CONFIG = {
            PROVERBS_URL: 'proverbs.json', // Assurez-vous que ce fichier existe
            ITEMS_PER_PAGE: 24,
            // Note: En production r√©elle, utilisez un backend proxy pour la cl√© API
            GEMINI_KEY: 'AIzaSyD3cGyEYYhNbFN6WlMKb5wjpdDqfR8RaN4' 
        };

        const app = {
            state: {
                proverbs: [],
                filteredProverbs: [],
                favorites: new Set(),
                currentTheme: 'all',
                currentPage: 1,
                searchQuery: '',
                themeMode: 'light',
                isLoading: false
            },

            init: async () => {
                // Theme Init
                const savedTheme = localStorage.getItem('theme') || 'light';
                app.ui.setTheme(savedTheme);
                document.getElementById('year').textContent = new Date().getFullYear();

                // Favorites Init
                const savedFavs = JSON.parse(localStorage.getItem('favorites') || '[]');
                app.state.favorites = new Set(savedFavs);

                try {
                    const response = await fetch(CONFIG.PROVERBS_URL);
                    if (!response.ok) throw new Error('Erreur r√©seau');
                    const data = await response.json();
                    
                    // Normalisation des donn√©es (ajout d'ID si absent)
                    app.state.proverbs = data.map((p, i) => ({...p, id: i, searchStr: app.utils.normalize(`${p.kabyle} ${p.francais}`)}));
                    app.state.filteredProverbs = [...app.state.proverbs];

                    // Initialisation UI
                    app.home.initDaily();
                    app.explorer.renderThemes();
                    app.explorer.loadMore(true); // Chargement initial
                    app.ui.hideSplash();
                    
                    // Setup Event Listeners
                    app.events.setup();
                } catch (e) {
                    console.error(e);
                    app.ui.toast('Impossible de charger les proverbes. V√©rifiez proverbs.json', 'error');
                    app.ui.hideSplash();
                    document.getElementById('results-grid').innerHTML = `<div class="col-span-full text-center text-red-500">Erreur de chargement des donn√©es.<br>Veuillez v√©rifier que le fichier proverbs.json est pr√©sent.</div>`;
                }
            },

            // --- MODULE NAVIGATION ---
            nav: {
                switchTab: (tabId) => {
                    // Update Contenu
                    document.querySelectorAll('.tab-content').forEach(el => {
                        el.classList.remove('active');
                        if (el.id === tabId) {
                            el.classList.add('active');
                            // Petit d√©lai pour l'animation CSS
                            setTimeout(() => el.style.opacity = 1, 50);
                        }
                    });

                    // Update Boutons Desktop
                    document.querySelectorAll('nav .nav-item').forEach(btn => {
                        if (btn.dataset.target === tabId) {
                            btn.classList.add('bg-white', 'dark:bg-gray-700', 'text-kabyle-primary', 'shadow-sm');
                        } else {
                            btn.classList.remove('bg-white', 'dark:bg-gray-700', 'text-kabyle-primary', 'shadow-sm');
                        }
                    });

                    // Update Boutons Mobile
                    document.querySelectorAll('.mobile-nav-item').forEach(btn => {
                        const isActive = btn.dataset.target === tabId;
                        btn.classList.toggle('text-kabyle-primary', isActive);
                        btn.classList.toggle('text-gray-400', !isActive);
                    });

                    // Logique sp√©cifique par onglet
                    if (tabId === 'favoris-tab') app.favorites.render();
                    
                    window.scrollTo({top: 0, behavior: 'smooth'});
                }
            },

            // --- MODULE HOME ---
            home: {
                initDaily: () => {
                    if (!app.state.proverbs.length) return;
                    // Algorithme simple bas√© sur la date pour avoir un proverbe constant par jour
                    const today = new Date();
                    const startOfYear = new Date(today.getFullYear(), 0, 0);
                    const diff = today - startOfYear;
                    const oneDay = 1000 * 60 * 60 * 24;
                    const dayOfYear = Math.floor(diff / oneDay);
                    
                    const index = dayOfYear % app.state.proverbs.length;
                    const proverb = app.state.proverbs[index];

                    document.getElementById('daily-date').textContent = today.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' });
                    document.getElementById('daily-proverb-container').innerHTML = app.ui.components.cardContent(proverb, true);
                }
            },

            // --- MODULE EXPLORER (Recherche & Liste) ---
            explorer: {
                renderThemes: () => {
                    // Extraction des th√®mes uniques
                    const themes = new Set();
                    app.state.proverbs.forEach(p => {
                        if (p.theme) p.theme.split(',').forEach(t => themes.add(t.trim()));
                    });
                    
                    const container = document.getElementById('theme-filters');
                    const allBtn = `<button class="theme-btn active px-4 py-1.5 rounded-full text-sm bg-kabyle-primary text-white whitespace-nowrap transition-all" data-theme="all" onclick="app.explorer.filterTheme('all', this)">Tous</button>`;
                    
                    const otherBtns = Array.from(themes).sort().map(t => 
                        `<button class="theme-btn px-4 py-1.5 rounded-full text-sm bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 whitespace-nowrap hover:bg-kabyle-primary/20 transition-all" data-theme="${t}" onclick="app.explorer.filterTheme('${t}', this)">${t}</button>`
                    ).join('');

                    container.innerHTML = allBtn + otherBtns;
                },

                filterTheme: (theme, btnElement) => {
                    app.state.currentTheme = theme;
                    app.state.currentPage = 1;
                    
                    // UI Updates
                    document.querySelectorAll('.theme-btn').forEach(b => {
                        b.classList.remove('bg-kabyle-primary', 'text-white');
                        b.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700');
                    });
                    btnElement.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700');
                    btnElement.classList.add('bg-kabyle-primary', 'text-white');

                    app.explorer.applyFilters();
                },

                search: (query) => {
                    app.state.searchQuery = app.utils.normalize(query);
                    app.state.currentPage = 1;
                    
                    const clearBtn = document.getElementById('clear-search');
                    if (query.length > 0) clearBtn.classList.remove('hidden');
                    else clearBtn.classList.add('hidden');

                    app.explorer.applyFilters();
                },

                applyFilters: () => {
                    const { searchQuery, currentTheme, proverbs } = app.state;
                    
                    app.state.filteredProverbs = proverbs.filter(p => {
                        const matchesTheme = currentTheme === 'all' || (p.theme && p.theme.includes(currentTheme));
                        const matchesSearch = !searchQuery || p.searchStr.includes(searchQuery);
                        return matchesTheme && matchesSearch;
                    });

                    app.explorer.loadMore(true); // Reset et reload
                },

                loadMore: (reset = false) => {
                    const grid = document.getElementById('results-grid');
                    const stats = document.getElementById('results-stats');
                    
                    if (reset) {
                        grid.innerHTML = '';
                        app.state.currentPage = 1;
                    }

                    const start = (app.state.currentPage - 1) * CONFIG.ITEMS_PER_PAGE;
                    const end = start + CONFIG.ITEMS_PER_PAGE;
                    const chunk = app.state.filteredProverbs.slice(start, end);

                    stats.textContent = `${app.state.filteredProverbs.length} proverbe(s) trouv√©(s)`;

                    if (chunk.length === 0 && reset) {
                        grid.innerHTML = `<div class="col-span-full py-12 text-center text-gray-500 flex flex-col items-center">
                            <span class="text-4xl mb-2">üòï</span>
                            <p>Aucun r√©sultat ne correspond √† votre recherche.</p>
                        </div>`;
                        return;
                    }

                    const fragment = document.createDocumentFragment();
                    chunk.forEach(p => {
                        const div = document.createElement('div');
                        div.className = 'bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-100 dark:border-gray-700 card-hover flex flex-col animate-fade-in-up';
                        div.innerHTML = app.ui.components.cardContent(p);
                        fragment.appendChild(div);
                    });

                    grid.appendChild(fragment);
                    
                    // Gestion du bouton "Infinite Scroll" ou Load More
                    const loader = document.getElementById('load-more-trigger');
                    if (end >= app.state.filteredProverbs.length) {
                        loader.classList.add('hidden');
                    } else {
                        loader.classList.remove('hidden');
                        loader.classList.remove('opacity-0');
                        app.state.currentPage++;
                    }
                },

                random: () => {
                    const r = Math.floor(Math.random() * app.state.proverbs.length);
                    const p = app.state.proverbs[r];
                    app.ui.openModal('D√©couverte Al√©atoire', app.ui.components.modalDetail(p));
                }
            },

            // --- MODULE FAVORIS ---
            favorites: {
                toggle: (id, btnElement) => {
                    const isFav = app.state.favorites.has(id);
                    if (isFav) {
                        app.state.favorites.delete(id);
                        app.ui.toast('Retir√© des favoris');
                    } else {
                        app.state.favorites.add(id);
                        app.ui.toast('Ajout√© aux favoris');
                    }
                    
                    localStorage.setItem('favorites', JSON.stringify([...app.state.favorites]));
                    
                    // Update UI de tous les boutons pour cet ID
                    document.querySelectorAll(`.fav-btn[data-id="${id}"]`).forEach(btn => {
                        btn.innerHTML = app.ui.icons.heart(app.state.favorites.has(id));
                        btn.classList.toggle('text-red-500', app.state.favorites.has(id));
                    });

                    // Si on est sur l'onglet favoris, re-rendre
                    if (document.getElementById('favoris-tab').classList.contains('active')) {
                        app.favorites.render();
                    }
                },

                render: () => {
                    const grid = document.getElementById('favorites-grid');
                    const emptyState = document.getElementById('no-favorites');
                    
                    if (app.state.favorites.size === 0) {
                        grid.innerHTML = '';
                        emptyState.classList.remove('hidden');
                        return;
                    }
                    
                    emptyState.classList.add('hidden');
                    const favs = app.state.proverbs.filter(p => app.state.favorites.has(p.id));
                    
                    grid.innerHTML = favs.map(p => `
                        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-100 dark:border-gray-700 card-hover flex flex-col">
                            ${app.ui.components.cardContent(p)}
                        </div>
                    `).join('');
                }
            },

            // --- MODULE AI (GEMINI) ---
            ai: {
                ask: async () => {
                    const input = document.getElementById('ai-input');
                    const responseArea = document.getElementById('ai-response-area');
                    const btn = document.getElementById('ai-submit-btn');
                    const query = input.value.trim();

                    if (!query) return;

                    // UI Loading
                    btn.disabled = true;
                    responseArea.innerHTML = `<div class="flex flex-col items-center py-4"><div class="spinner text-kabyle-primary mb-2"></div><span class="text-sm text-gray-500">Le sage r√©fl√©chit...</span></div>`;

                    try {
                        // 1. R√©cup√©rer des mots cl√©s via IA
                        const prompt = `Analyse cette situation: "${query}". Donne-moi 5 mots-cl√©s pertinents en fran√ßais pour trouver un proverbe kabyle (ex: patience, courage, trahison). Format JSON: ["mot1", "mot2"]`;
                        
                        const keywordResponse = await app.ai.callApi(prompt);
                        let keywords = [];
                        try {
                            keywords = JSON.parse(keywordResponse.replace(/```json|```/g, '').trim());
                        } catch (e) {
                             keywords = [query]; // Fallback
                        }

                        // 2. Recherche locale
                        const searchResults = app.state.proverbs.filter(p => {
                            const str = app.utils.normalize(`${p.francais} ${p.theme}`);
                            return keywords.some(k => str.includes(app.utils.normalize(k)));
                        }).slice(0, 10); // Top 10 candidats

                        if (searchResults.length === 0) {
                            throw new Error('Aucun proverbe pertinent trouv√© localement.');
                        }

                        // 3. Demander √† l'IA de choisir le meilleur parmi les candidats
                        const contextData = JSON.stringify(searchResults.map(p => ({id: p.id, fr: p.francais, kb: p.kabyle})));
                        const finalPrompt = `Situation: "${query}". Voici des proverbes candidats: ${contextData}. Choisis le meilleur (et un 2√®me si pertinent). Explique pourquoi bri√®vement. R√©ponds en HTML simple (sans balises html/body). Mets les proverbes en √©vidence.`;
                        
                        const finalResponse = await app.ai.callApi(finalPrompt);
                        
                        responseArea.innerHTML = `<div class="prose dark:prose-invert text-sm">${finalResponse.replace(/```html|```/g, '')}</div>`;
                        
                    } catch (e) {
                        responseArea.innerHTML = `<p class="text-red-500 text-center">Le sage est confus. Essayez de reformuler. (${e.message})</p>`;
                    } finally {
                        btn.disabled = false;
                    }
                },

                callApi: async (text) => {
                    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${CONFIG.GEMINI_KEY}`;
                    const payload = {
                        contents: [{ parts: [{ text: text }] }]
                    };
                    
                    const res = await fetch(url, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(payload)
                    });
                    
                    const data = await res.json();
                    return data.candidates[0].content.parts[0].text;
                }
            },

            // --- MODULE QUIZ ---
            quiz: {
                questions: [],
                currentQ: 0,
                score: 0,

                start: async () => {
                    document.getElementById('quiz-start').classList.add('hidden');
                    const gameDiv = document.getElementById('quiz-game');
                    gameDiv.classList.remove('hidden');
                    gameDiv.innerHTML = `<div class="flex flex-col items-center justify-center h-40"><div class="spinner text-kabyle-primary"></div><p class="mt-2 text-gray-500">Pr√©paration du quiz...</p></div>`;

                    // G√©n√©ration de 5 questions al√©atoires
                    const selection = [...app.state.proverbs].sort(() => 0.5 - Math.random()).slice(0, 5);
                    
                    app.quiz.questions = selection.map(p => {
                        // G√©n√©rer des mauvaises r√©ponses (distracteurs)
                        const distractors = [...app.state.proverbs]
                            .filter(x => x.id !== p.id)
                            .sort(() => 0.5 - Math.random())
                            .slice(0, 3)
                            .map(x => x.francais);
                        
                        const options = [p.francais, ...distractors].sort(() => 0.5 - Math.random());

                        return {
                            question: p.kabyle,
                            correct: p.francais,
                            options: options,
                            explanation: p.explication || "Pas d'explication disponible."
                        };
                    });

                    app.quiz.currentQ = 0;
                    app.quiz.score = 0;
                    app.quiz.renderQuestion();
                },

                renderQuestion: () => {
                    if (app.quiz.currentQ >= app.quiz.questions.length) {
                        app.quiz.end();
                        return;
                    }

                    const q = app.quiz.questions[app.quiz.currentQ];
                    const gameDiv = document.getElementById('quiz-game');
                    
                    gameDiv.innerHTML = `
                        <div class="flex justify-between items-center mb-6 text-sm font-medium text-gray-400">
                            <span>Question ${app.quiz.currentQ + 1}/5</span>
                            <span class="text-kabyle-primary">Score: ${app.quiz.score}</span>
                        </div>
                        <h3 class="text-xl font-serif font-bold text-center mb-6 text-kabyle-dark dark:text-white">¬´ ${q.question} ¬ª</h3>
                        <div class="space-y-3">
                            ${q.options.map((opt, i) => `
                                <button onclick="app.quiz.checkAnswer(this, ${opt === q.correct})" class="w-full text-left p-4 rounded-xl border-2 border-gray-100 dark:border-gray-700 hover:border-kabyle-primary/50 transition-all dark:text-gray-300">
                                    ${opt}
                                </button>
                            `).join('')}
                        </div>
                    `;
                },

                checkAnswer: (btn, isCorrect) => {
                    // D√©sactiver les clics
                    const buttons = document.querySelectorAll('#quiz-game button');
                    buttons.forEach(b => b.disabled = true);

                    if (isCorrect) {
                        btn.classList.add('bg-green-100', 'border-green-500', 'dark:bg-green-900/30', 'dark:border-green-500');
                        app.quiz.score++;
                    } else {
                        btn.classList.add('bg-red-100', 'border-red-500', 'dark:bg-red-900/30', 'dark:border-red-500');
                        // Montrer la bonne r√©ponse
                        buttons.forEach(b => {
                            if (b.textContent.trim() === app.quiz.questions[app.quiz.currentQ].correct) {
                                b.classList.add('bg-green-100', 'border-green-500', 'dark:bg-green-900/30');
                            }
                        });
                    }

                    setTimeout(() => {
                        app.quiz.currentQ++;
                        app.quiz.renderQuestion();
                    }, 1500);
                },

                end: () => {
                    const gameDiv = document.getElementById('quiz-game');
                    let msg = "Pas mal !";
                    if (app.quiz.score === 5) msg = "Excellent ! Un vrai sage.";
                    if (app.quiz.score < 2) msg = "Continuez d'apprendre !";

                    gameDiv.innerHTML = `
                        <div class="text-center py-8">
                            <div class="text-6xl mb-4">üèÜ</div>
                            <h3 class="text-2xl font-bold mb-2">Quiz Termin√©</h3>
                            <p class="text-4xl font-bold text-kabyle-primary mb-4">${app.quiz.score} / 5</p>
                            <p class="text-gray-500 mb-8">${msg}</p>
                            <button onclick="app.quiz.start()" class="px-6 py-3 bg-kabyle-secondary text-white rounded-xl font-bold shadow-md">Rejouer</button>
                            <button onclick="app.nav.switchTab('accueil-tab')" class="block mt-4 text-sm text-gray-400 mx-auto hover:underline">Retour √† l'accueil</button>
                        </div>
                    `;
                }
            },

            // --- MODULE UI & UTILS ---
            ui: {
                hideSplash: () => {
                    const splash = document.getElementById('splash-screen');
                    splash.style.opacity = 0;
                    setTimeout(() => splash.style.display = 'none', 700);
                },
                
                toast: (msg, type = 'success') => {
                    const el = document.getElementById('toast');
                    const icon = document.getElementById('toast-icon');
                    const txt = document.getElementById('toast-msg');
                    
                    icon.textContent = type === 'error' ? '‚ö†Ô∏è' : '‚úÖ';
                    txt.textContent = msg;
                    el.className = `fixed bottom-24 md:bottom-10 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 z-[100] transition-transform duration-300 ${type === 'error' ? 'bg-red-600 text-white' : 'bg-gray-800 text-white'}`;
                    
                    // Show
                    requestAnimationFrame(() => el.classList.remove('translate-y-[150%]'));
                    
                    setTimeout(() => {
                        el.classList.add('translate-y-[150%]');
                    }, 3000);
                },

                setTheme: (mode) => {
                    app.state.themeMode = mode;
                    if (mode === 'dark') {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                    localStorage.setItem('theme', mode);
                },

                toggleTheme: () => {
                    app.ui.setTheme(app.state.themeMode === 'light' ? 'dark' : 'light');
                },

                openModal: (title, content) => {
                    document.getElementById('modal-title').textContent = title;
                    document.getElementById('modal-body').innerHTML = content;
                    
                    const overlay = document.getElementById('modal-overlay');
                    const modal = document.getElementById('modal-content');
                    
                    overlay.classList.remove('hidden');
                    modal.classList.remove('hidden');
                    
                    // Animation
                    setTimeout(() => {
                        overlay.classList.remove('opacity-0');
                        modal.classList.remove('opacity-0', 'scale-95');
                    }, 10);
                },

                closeModal: () => {
                    const overlay = document.getElementById('modal-overlay');
                    const modal = document.getElementById('modal-content');
                    
                    overlay.classList.add('opacity-0');
                    modal.classList.add('opacity-0', 'scale-95');
                    
                    setTimeout(() => {
                        overlay.classList.add('hidden');
                        modal.classList.add('hidden');
                    }, 300);
                },

                components: {
                    cardContent: (p, isDaily = false) => {
                        const highlight = (text) => {
                            if (!app.state.searchQuery || isDaily) return text;
                            const regex = new RegExp(`(${app.state.searchQuery})`, 'gi');
                            return text.replace(regex, '<mark>$1</mark>');
                        };

                        const isFav = app.state.favorites.has(p.id);
                        
                        return `
                            <div class="flex-grow cursor-pointer" onclick="app.ui.openModal('D√©tails du Proverbe', app.ui.components.modalDetail(app.state.proverbs[${p.id}]))">
                                <p class="font-serif text-xl ${isDaily ? 'text-2xl' : ''} font-bold text-kabyle-dark dark:text-white mb-2 italic">¬´ ${highlight(p.kabyle)} ¬ª</p>
                                <p class="text-gray-600 dark:text-gray-400 ${isDaily ? 'text-lg' : 'text-sm'} mb-4 leading-relaxed">${highlight(p.francais)}</p>
                                ${p.theme ? `<span class="inline-block px-2 py-1 rounded bg-gray-100 dark:bg-gray-700 text-xs text-gray-500 uppercase tracking-wide">${p.theme.split(',')[0]}</span>` : ''}
                            </div>
                            <div class="mt-4 pt-4 border-t border-gray-100 dark:border-gray-700 flex justify-between items-center">
                                <button onclick="app.utils.share(${p.id})" class="text-gray-400 hover:text-kabyle-primary transition-colors p-1 rounded-full hover:bg-gray-50 dark:hover:bg-gray-700" title="Copier">
                                    ${app.ui.icons.copy}
                                </button>
                                <button onclick="app.favorites.toggle(${p.id}, this)" class="fav-btn p-1 rounded-full transition-all hover:scale-110 ${isFav ? 'text-red-500' : 'text-gray-300 hover:text-red-300'}" data-id="${p.id}">
                                    ${app.ui.icons.heart(isFav)}
                                </button>
                            </div>
                        `;
                    },
                    
                    modalDetail: (p) => {
                        return `
                            <div class="text-center mb-6">
                                <p class="text-2xl font-serif font-bold text-kabyle-primary dark:text-white italic mb-2">¬´ ${p.kabyle} ¬ª</p>
                                <p class="text-lg text-gray-700 dark:text-gray-300">${p.francais}</p>
                            </div>
                            <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg mb-4">
                                <h4 class="font-bold text-sm text-gray-500 uppercase mb-2">Explication</h4>
                                <p class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed">${p.explication || "Pas d'explication d√©taill√©e disponible pour ce proverbe."}</p>
                            </div>
                            <div class="flex justify-center gap-4 mt-6">
                                <button onclick="app.utils.copyToClipboard('¬´ ${p.kabyle} ¬ª - ${p.francais}')" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm font-bold hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">Copier</button>
                            </div>
                        `;
                    }
                },

                icons: {
                    heart: (filled) => `<svg class="w-6 h-6" fill="${filled ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>`,
                    copy: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg>`
                }
            },

            utils: {
                normalize: (str) => {
                    return str.toLowerCase()
                        .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
                        .replace(/«ß/g, 'g').replace(/ƒç/g, 'c') // Normalisation sp√©cifique Kabyle
                        .replace(/…£/g, 'gh').replace(/…õ/g, 'aa');
                },

                debounce: (func, wait) => {
                    let timeout;
                    return function(...args) {
                        clearTimeout(timeout);
                        timeout = setTimeout(() => func.apply(this, args), wait);
                    };
                },

                copyToClipboard: (text) => {
                    navigator.clipboard.writeText(text).then(() => app.ui.toast('Texte copi√© !'));
                },

                share: (id) => {
                    const p = app.state.proverbs[id];
                    const text = `¬´ ${p.kabyle} ¬ª\n${p.francais}`;
                    app.utils.copyToClipboard(text);
                }
            },

            events: {
                setup: () => {
                    // Search Input (Debounced)
                    const searchInput = document.getElementById('search-input');
                    searchInput.addEventListener('input', app.utils.debounce((e) => {
                        app.explorer.search(e.target.value);
                    }, 300));

                    document.getElementById('clear-search').addEventListener('click', () => {
                        searchInput.value = '';
                        app.explorer.search('');
                    });

                    // Load More Scroll
                    const observer = new IntersectionObserver((entries) => {
                        if (entries[0].isIntersecting) app.explorer.loadMore();
                    }, { threshold: 0.1 });
                    observer.observe(document.getElementById('load-more-trigger'));

                    // Theme Toggle
                    document.getElementById('theme-toggle').addEventListener('click', app.ui.toggleTheme);

                    // AI
                    document.getElementById('ai-submit-btn').addEventListener('click', app.ai.ask);

                    // Quiz
                    document.getElementById('start-quiz-btn').addEventListener('click', app.quiz.start);
                }
            }
        };

        // Lancement de l'application
        document.addEventListener('DOMContentLoaded', app.init);

    </script>
</body>
</html>

